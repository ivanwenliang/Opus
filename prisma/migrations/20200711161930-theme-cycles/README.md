# Migration `20200711161930-theme-cycles`

This migration has been generated by Ivan Liang at 7/11/2020, 4:19:30 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TABLE "public"."Theme" (
"completedAt" timestamp(3)   ,"createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,"deadline" timestamp(3)  NOT NULL ,"id" SERIAL,"isCompleted" boolean  NOT NULL DEFAULT false,"themeDescription" text   ,"themeStatement" text  NOT NULL ,"userId" text  NOT NULL ,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."Cycle" (
"completedAt" timestamp(3)   ,"createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,"cycleDescription" text   ,"cycleStatement" text  NOT NULL ,"endDate" timestamp(3)  NOT NULL ,"id" SERIAL,"isCompleted" boolean  NOT NULL DEFAULT false,"startDate" timestamp(3)  NOT NULL ,"themeId" integer  NOT NULL ,"userId" text  NOT NULL ,
    PRIMARY KEY ("id"))

ALTER TABLE "public"."WeeklyGoal" DROP CONSTRAINT IF EXiSTS "WeeklyGoal_monthlyGoalId_fkey",
DROP COLUMN "completionDate",
DROP COLUMN "monthlyGoalId",
DROP COLUMN "nickname",
DROP COLUMN "week",
ADD COLUMN "completedAt" timestamp(3)   ,
ADD COLUMN "cycleId" integer  NOT NULL ,
ADD COLUMN "weekStart" timestamp(3)  NOT NULL ;

ALTER TABLE "public"."AnnualGoal" DROP CONSTRAINT IF EXiSTS "AnnualGoal_userId_fkey";

ALTER TABLE "public"."MonthlyGoal" DROP CONSTRAINT IF EXiSTS "MonthlyGoal_annualGoalId_fkey";

ALTER TABLE "public"."MonthlyGoal" DROP CONSTRAINT IF EXiSTS "MonthlyGoal_userId_fkey";

ALTER TABLE "public"."Theme" ADD FOREIGN KEY ("userId")REFERENCES "public"."User"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."Cycle" ADD FOREIGN KEY ("userId")REFERENCES "public"."User"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."Cycle" ADD FOREIGN KEY ("themeId")REFERENCES "public"."Theme"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."WeeklyGoal" ADD FOREIGN KEY ("cycleId")REFERENCES "public"."Cycle"("id") ON DELETE CASCADE  ON UPDATE CASCADE

DROP TABLE "public"."AnnualGoal";

DROP TABLE "public"."MonthlyGoal";
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20200703153056-iscompleted-default..20200711161930-theme-cycles
--- datamodel.dml
+++ datamodel.dml
@@ -2,68 +2,64 @@
 // learn more about it in the docs: https://pris.ly/d/prisma-schema
 datasource db {
   provider = "postgresql"
-  url = "***"
+  url = "***"
 }
 generator client {
   provider = "prisma-client-js"
 }
 model User {
-  id           String        @id
-  email        String        @unique
-  displayName  String?
-  photoURL     String?
-  createdAt    DateTime      @default(now())
-  annualGoals  AnnualGoal[]
-  monthlyGoals MonthlyGoal[]
-  weeklyGoals  WeeklyGoal[]
+  id          String       @id
+  email       String       @unique
+  displayName String?
+  photoURL    String?
+  createdAt   DateTime     @default(now())
+  themes      Theme[]
+  cycles      Cycle[]
+  weeklyGoals WeeklyGoal[]
 }
-// Consider a smaller period like quarters?
-model AnnualGoal {
-  id              Int           @id @default(autoincrement())
-  goalStatement   String
-  goalDescription String?
-  nickname        String
-  isCompleted     Boolean       @default(false)
-  createdAt       DateTime      @default(now())
-  year            DateTime
-  completionDate  DateTime?
-  user            User          @relation(fields: [userId], references: [id])
-  userId          String
-  monthlyGoals    MonthlyGoal[]
+model Theme {
+  id               Int       @id @default(autoincrement())
+  user             User      @relation(fields: [userId], references: [id])
+  userId           String
+  themeStatement   String
+  themeDescription String?
+  isCompleted      Boolean   @default(false)
+  completedAt      DateTime?
+  createdAt        DateTime  @default(now())
+  deadline         DateTime
+  cycles           Cycle[]
 }
-// Each annual goal has 36 monthly goals?
-model MonthlyGoal {
-  id              Int          @id @default(autoincrement())
-  goalStatement   String
-  goalDescription String?
-  nickname        String
-  isCompleted     Boolean      @default(false)
-  createdAt       DateTime     @default(now())
-  month           DateTime
-  completionDate  DateTime?
-  user            User         @relation(fields: [userId], references: [id])
-  userId          String
-  annualGoal      AnnualGoal   @relation(fields: [annualGoalId], references: [id])
-  annualGoalId    Int
-  weeklyGoals     WeeklyGoal[]
+model Cycle {
+  id               Int          @id @default(autoincrement())
+  user             User         @relation(fields: [userId], references: [id])
+  userId           String
+  theme            Theme        @relation(fields: [themeId], references: [id])
+  themeId          Int
+  cycleStatement   String
+  cycleDescription String?
+  isCompleted      Boolean      @default(false)
+  completedAt      DateTime?
+  createdAt        DateTime     @default(now())
+  startDate        DateTime
+  endDate          DateTime
+  weeklyGoals      WeeklyGoal[]
 }
 model WeeklyGoal {
-  id              Int         @id @default(autoincrement())
+  id              Int       @id @default(autoincrement())
+  user            User      @relation(fields: [userId], references: [id])
+  userId          String
+  cycle           Cycle     @relation(fields: [cycleId], references: [id])
+  cycleId         Int
   goalStatement   String
   goalDescription String?
-  nickname        String
-  isCompleted     Boolean     @default(false)
-  createdAt       DateTime    @default(now())
-  week            DateTime
-  completionDate  DateTime?
-  user            User        @relation(fields: [userId], references: [id])
-  userId          String
-  monthlyGoal     MonthlyGoal @relation(fields: [monthlyGoalId], references: [id])
-  monthlyGoalId   Int
+  isCompleted     Boolean   @default(false)
+  completedAt     DateTime?
+  createdAt       DateTime  @default(now())
+  weekStart       DateTime
 }
```


